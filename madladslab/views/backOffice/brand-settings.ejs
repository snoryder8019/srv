<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
      padding: 1rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      font-size: 2rem;
      color: #333;
      margin-bottom: 0.5rem;
    }

    .breadcrumb {
      color: #666;
      font-size: 0.9rem;
    }

    .breadcrumb a {
      color: #667eea;
      text-decoration: none;
    }

    .section {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .section h2 {
      font-size: 1.5rem;
      color: #333;
      margin-bottom: 1.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid #f0f0f0;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      font-weight: 600;
      color: #333;
      margin-bottom: 0.5rem;
    }

    input[type="text"],
    textarea,
    select {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #667eea;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
    }

    .btn:hover {
      background: #5568d3;
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: #6c757d;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .btn-danger {
      background: #dc3545;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .employees-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    .employees-table th,
    .employees-table td {
      text-align: left;
      padding: 0.875rem;
      border-bottom: 1px solid #f0f0f0;
    }

    .employees-table th {
      background: #f8f9fa;
      font-weight: 600;
      color: #333;
    }

    .employees-table tbody tr:hover {
      background: #f8f9fa;
    }

    .role-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .role-badge.admin {
      background: #fee;
      color: #c33;
    }

    .role-badge.manager {
      background: #fef7e0;
      color: #c96;
    }

    .role-badge.staff {
      background: #e8f4f8;
      color: #36c;
    }

    .danger-zone {
      border: 2px solid #dc3545;
      border-radius: 12px;
      padding: 1.5rem;
      background: #fff5f5;
    }

    .danger-zone h3 {
      color: #dc3545;
      margin-bottom: 1rem;
    }

    @media (max-width: 768px) {
      body {
        padding: 0.5rem;
      }

      .header {
        padding: 1rem;
      }

      .section {
        padding: 1.5rem;
      }

      .header h1 {
        font-size: 1.5rem;
      }

      .employees-table {
        font-size: 0.9rem;
      }

      .employees-table th,
      .employees-table td {
        padding: 0.5rem;
      }

      /* Make table scrollable on mobile */
      .table-wrapper {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      input[type="text"],
      textarea,
      select {
        font-size: 16px; /* Prevents zoom on iOS */
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>⚙️ Brand Settings</h1>
      <div class="breadcrumb">
        <a href="/backoffice/<%= brand.slug %>">← Back to Dashboard</a>
      </div>
    </div>

    <div class="section">
      <h2>Brand Information</h2>
      <form id="brandInfoForm">
        <div class="form-group">
          <label for="name">Brand Name</label>
          <input type="text" id="name" name="name" value="<%= brand.name %>" required>
        </div>

        <div class="form-group">
          <label for="description">Description</label>
          <textarea id="description" name="description"><%= brand.description || '' %></textarea>
        </div>

        <div class="form-group">
          <label for="industry">Industry</label>
          <select id="industry" name="industry">
            <option value="restaurant" <%= brand.industry === 'restaurant' ? 'selected' : '' %>>Restaurant</option>
            <option value="retail" <%= brand.industry === 'retail' ? 'selected' : '' %>>Retail</option>
            <option value="service" <%= brand.industry === 'service' ? 'selected' : '' %>>Service</option>
            <option value="tech" <%= brand.industry === 'tech' ? 'selected' : '' %>>Technology</option>
            <option value="healthcare" <%= brand.industry === 'healthcare' ? 'selected' : '' %>>Healthcare</option>
            <option value="education" <%= brand.industry === 'education' ? 'selected' : '' %>>Education</option>
            <option value="hospitality" <%= brand.industry === 'hospitality' ? 'selected' : '' %>>Hospitality</option>
            <option value="other" <%= brand.industry === 'other' ? 'selected' : '' %>>Other</option>
          </select>
        </div>

        <button type="submit" class="btn">Save Changes</button>
      </form>
    </div>

    <div class="section">
      <h2>Employees (<%=employees.length %>)</h2>
      <div class="table-wrapper">
        <table class="employees-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Position</th>
              <th>Department</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <% if (employees.length === 0) { %>
              <tr>
                <td colspan="6" style="text-align: center; color: #999; padding: 2rem;">
                  No employees yet
                </td>
              </tr>
            <% } else { %>
              <% employees.forEach(emp => { %>
                <tr>
                  <td><%= emp.userId.displayName || emp.userId.firstName + ' ' + emp.userId.lastName %></td>
                  <td><%= emp.userId.email %></td>
                  <td><span class="role-badge <%= emp.role %>"><%= emp.role %></span></td>
                  <td><%= emp.position %></td>
                  <td><%= emp.department %></td>
                  <td><%= emp.status %></td>
                </tr>
              <% }); %>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>

    <div class="section danger-zone">
      <h3>⚠️ Danger Zone</h3>
      <p style="margin-bottom: 1rem; color: #666;">
        Once you archive a brand, there is no going back. All data will be preserved but inaccessible.
      </p>
      <button class="btn btn-danger" onclick="confirmArchive()">Archive Brand</button>
    </div>
  </div>

  <script>
    document.getElementById('brandInfoForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = {
        name: document.getElementById('name').value,
        description: document.getElementById('description').value,
        industry: document.getElementById('industry').value
      };

      try {
        const response = await fetch('/backoffice/api/brands/<%= brand._id %>/update', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        if (response.ok) {
          alert('Brand information updated successfully!');
          location.reload();
        } else {
          const data = await response.json();
          alert('Error: ' + (data.error || 'Failed to update brand'));
        }
      } catch (error) {
        console.error('Error updating brand:', error);
        alert('An error occurred. Please try again.');
      }
    });

    function confirmArchive() {
      if (confirm('Are you sure you want to archive this brand? This action cannot be undone.')) {
        if (confirm('FINAL WARNING: All employees will lose access. Type the brand name to confirm.')) {
          const brandName = prompt('Type "<%= brand.name %>" to confirm:');
          if (brandName === '<%= brand.name %>') {
            alert('Archive functionality will be implemented in the next update.');
            // TODO: Implement archive API call
          } else {
            alert('Brand name did not match. Archive cancelled.');
          }
        }
      }
    }
  </script>

  <%-include('../mainContent/adminNav.ejs')%>
</body>
</html>
