<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patch Notes - v0.4</title>
  <link rel="stylesheet" href="/stylesheets/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
    }
    .notes-container {
      max-width: 1000px;
      margin: 2rem auto;
      padding: 2rem;
      background: rgba(30, 41, 59, 0.8);
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(148, 163, 184, 0.2);
    }
    .notes-header {
      text-align: center;
      padding-bottom: 2rem;
      border-bottom: 2px solid rgba(99, 102, 241, 0.5);
      margin-bottom: 2rem;
    }
    .notes-header h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.5rem;
      margin: 0;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .notes-meta {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-top: 1rem;
      font-size: 0.875rem;
      color: #94a3b8;
    }
    .section {
      margin-bottom: 3rem;
    }
    .section h2 {
      font-family: 'Orbitron', sans-serif;
      color: #6366f1;
      margin-top: 0;
      margin-bottom: 1.5rem;
      font-size: 1.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid rgba(99, 102, 241, 0.3);
    }
    .section h3 {
      color: #8b5cf6;
      margin-top: 1.5rem;
      margin-bottom: 1rem;
      font-size: 1.25rem;
    }
    .section h4 {
      color: #a78bfa;
      margin-top: 1rem;
      margin-bottom: 0.75rem;
      font-size: 1.1rem;
    }
    .section p {
      line-height: 1.8;
      color: #cbd5e1;
      margin-bottom: 1rem;
    }
    .section ul {
      list-style: none;
      padding-left: 0;
    }
    .section ul li {
      padding-left: 1.5rem;
      margin-bottom: 0.5rem;
      position: relative;
      line-height: 1.6;
    }
    .section ul li:before {
      content: "▸";
      position: absolute;
      left: 0;
      color: #6366f1;
      font-weight: bold;
    }
    .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 0.5rem;
      text-transform: uppercase;
    }
    .badge-new {
      background: rgba(34, 197, 94, 0.2);
      color: #4ade80;
      border: 1px solid #4ade80;
    }
    .badge-fix {
      background: rgba(59, 130, 246, 0.2);
      color: #60a5fa;
      border: 1px solid #60a5fa;
    }
    .badge-breaking {
      background: rgba(239, 68, 68, 0.2);
      color: #f87171;
      border: 1px solid #f87171;
    }
    .badge-improvement {
      background: rgba(168, 85, 247, 0.2);
      color: #c084fc;
      border: 1px solid #c084fc;
    }
    .warning-box {
      background: rgba(239, 68, 68, 0.1);
      border-left: 4px solid #ef4444;
      padding: 1rem 1.5rem;
      margin: 1.5rem 0;
      border-radius: 4px;
    }
    .warning-box strong {
      color: #f87171;
    }
    .info-box {
      background: rgba(59, 130, 246, 0.1);
      border-left: 4px solid #3b82f6;
      padding: 1rem 1.5rem;
      margin: 1.5rem 0;
      border-radius: 4px;
    }
    .info-box strong {
      color: #60a5fa;
    }
    .back-button {
      display: inline-block;
      margin: 2rem auto;
      padding: 0.75rem 2rem;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-weight: 600;
      transition: transform 0.2s, box-shadow 0.2s;
      text-align: center;
    }
    .back-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
    }
    .button-container {
      text-align: center;
      margin-top: 2rem;
    }
    code {
      background: rgba(15, 23, 42, 0.6);
      padding: 0.2rem 0.4rem;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      color: #a78bfa;
    }
  </style>
</head>
<body>
  <%- include('../partials/header', { user: user }) %>

  <div class="notes-container">
    <div class="notes-header">
      <h1>Patch Notes - v0.4.0</h1>
      <div class="notes-meta">
        <span>October 26, 2025</span>
        <span>•</span>
        <span>Build 0.4.0 "Foundation Arc"</span>
      </div>
    </div>

    <!-- Overview -->
    <div class="section">
      <h2>Overview</h2>
      <p>The v0.4 "Foundation Arc" update establishes the core systems for the Stringborn Universe. This is our first major public-facing release, bringing together months of infrastructure development into a cohesive, playable experience.</p>
    </div>

    <!-- New Features -->
    <div class="section">
      <h2>New Features <span class="badge badge-new">Added</span></h2>

      <h3>Galactic Map System</h3>
      <ul>
        <li><strong>Live Territory Navigator:</strong> Real-time visualization of faction-controlled zones</li>
        <li><strong>Player Position Streaming:</strong> See other players moving across the galaxy via websockets</li>
        <li><strong>Scatter Repulsion Algorithm:</strong> Natural character positioning preventing overlap</li>
        <li><strong>Quick Start Teleport:</strong> Admin/tester feature for rapid galaxy exploration</li>
        <li><strong>Map Persistence:</strong> Character positions and map state survive server restarts</li>
        <li><strong>Optimized Rendering:</strong> Efficient canvas rendering supporting hundreds of entities</li>
        <li><strong>Character-Linked Navigation:</strong> Deep links to galactic map with character selection</li>
      </ul>

      <h3>Character Management</h3>
      <ul>
        <li><strong>Character Creation Flow:</strong> Multi-step process with species, faction, and name selection</li>
        <li><strong>Talent Tree System:</strong> Canvas-based skill progression interface (visual demo available)</li>
        <li><strong>Equipment Loadouts:</strong> Equip items, weapons, and gear to characters</li>
        <li><strong>Character Detail View:</strong> Comprehensive stats, inventory, and progression tracking</li>
        <li><strong>Multi-Character Support:</strong> Create and manage multiple characters per account</li>
        <li><strong>Character-Scoped Sessions:</strong> Active character persists across sessions via localStorage</li>
      </ul>

      <h3>Asset Workshop</h3>
      <ul>
        <li><strong>Integrated Pixel Editor:</strong> Built-in canvas tool for sprite creation</li>
        <li><strong>Asset Submission Pipeline:</strong> Upload and submit custom content to the community</li>
        <li><strong>Asset Type System:</strong> Support for items, characters, environments, and more</li>
        <li><strong>Scale Variants:</strong> Automatic generation of 1x, 2x, 4x asset scales</li>
        <li><strong>My Assets Library:</strong> Personal gallery of submitted creations</li>
        <li><strong>Community Asset Gallery:</strong> Browse all player-created content</li>
      </ul>

      <h3>Voting & Governance</h3>
      <ul>
        <li><strong>Democratic Asset Approval:</strong> Community voting determines what enters the universe</li>
        <li><strong>Asset Review Interface:</strong> Detailed view of submissions with voting controls</li>
        <li><strong>Vote Tracking:</strong> See voting history and your participation</li>
        <li><strong>Approval Threshold System:</strong> Assets require community consensus to be approved</li>
        <li><strong>Transparent Governance:</strong> All votes and decisions are visible to players</li>
      </ul>

      <h3>Inventory System</h3>
      <ul>
        <li><strong>Dual Storage Model:</strong> Separate character and ship inventories</li>
        <li><strong>Item Management:</strong> Add, remove, and transfer items between storage locations</li>
        <li><strong>Equipment System:</strong> Equip/unequip items to character loadouts</li>
        <li><strong>Item Metadata:</strong> Rich item data including rarity, stats, and descriptions</li>
        <li><strong>Inventory Modal UI:</strong> Clean, accessible interface for item management</li>
        <li><strong>Admin Item Seeding:</strong> Development tools for testing inventory features</li>
      </ul>

      <h3>Admin & Developer Tools</h3>
      <ul>
        <li><strong>Tester Toolbar:</strong> In-game terminal with realtime socket monitoring</li>
        <li><strong>Telemetry Console:</strong> User behavior analytics and engagement metrics</li>
        <li><strong>Content Moderation Queue:</strong> Review and approve player submissions</li>
        <li><strong>Simulation Controls:</strong> Runtime parameter tuning for game state</li>
        <li><strong>Map Configuration Panel:</strong> Adjust traversal velocity, grid resolution, render distance</li>
        <li><strong>Asset Generator:</strong> Procedural entity creation and batch configuration</li>
        <li><strong>Script Control Panel:</strong> Database management and admin automation tools</li>
        <li><strong>User Administration:</strong> Account management and permissions</li>
      </ul>
    </div>

    <!-- Technical Improvements -->
    <div class="section">
      <h2>Technical Improvements <span class="badge badge-improvement">Enhanced</span></h2>

      <h3>Real-Time Synchronization</h3>
      <ul>
        <li><strong>Socket.io Integration:</strong> Robust websocket infrastructure for live updates</li>
        <li><strong>Connection Resilience:</strong> Automatic reconnection with exponential backoff</li>
        <li><strong>Event Broadcasting:</strong> Efficient server-to-client state synchronization</li>
        <li><strong>Room-Based Channels:</strong> Scoped socket communication for different game areas</li>
        <li><strong>Socket Debugging Tools:</strong> Built-in monitoring via tester toolbar</li>
      </ul>

      <h3>Database & State Management</h3>
      <ul>
        <li><strong>Character-Game State Sync:</strong> Automated synchronization between character and game state collections</li>
        <li><strong>Galaxy Reset Scripts:</strong> Clean reset tools for development and testing</li>
        <li><strong>Starting Location System:</strong> Configurable spawn points per faction</li>
        <li><strong>Persistent Sessions:</strong> Character selection survives browser refresh</li>
        <li><strong>Data Validation:</strong> Schema enforcement for all database operations</li>
      </ul>

      <h3>UI/UX Enhancements</h3>
      <ul>
        <li><strong>Layered Interface System:</strong> Proper z-indexing for modals, toolbars, and overlays</li>
        <li><strong>Responsive Modals:</strong> Inventory and character modals with clean animations</li>
        <li><strong>Terminal Theme Styling:</strong> Developer toolbar with monospace, tech aesthetic</li>
        <li><strong>Sync Indicators:</strong> Visual feedback for connection and sync status</li>
        <li><strong>Enhanced Landing Page:</strong> Polished sales/info page for new visitors</li>
        <li><strong>Menu Navigator:</strong> Centralized hub for all game systems</li>
        <li><strong>Auth Flow:</strong> Streamlined login/register with character selection</li>
      </ul>

      <h3>Performance Optimizations</h3>
      <ul>
        <li><strong>Efficient Map Rendering:</strong> Optimized canvas drawing for large entity counts</li>
        <li><strong>Lazy Loading:</strong> Deferred loading of non-critical resources</li>
        <li><strong>Debounced Updates:</strong> Throttled position updates to reduce socket traffic</li>
        <li><strong>Memory Management:</strong> Proper cleanup of event listeners and intervals</li>
        <li><strong>Client-Side Caching:</strong> LocalStorage for character selection and preferences</li>
      </ul>
    </div>

    <!-- Bug Fixes -->
    <div class="section">
      <h2>Bug Fixes <span class="badge badge-fix">Fixed</span></h2>

      <h3>Critical Fixes</h3>
      <ul>
        <li><strong>Socket Connection Stability:</strong> Resolved issues with connection drops and failed reconnections</li>
        <li><strong>Character-Game State Desync:</strong> Fixed discrepancies between character positions and game state</li>
        <li><strong>UI Layering Conflicts:</strong> Corrected z-index issues causing overlapping interface elements</li>
        <li><strong>Map Position Persistence:</strong> Character positions now properly save/restore across sessions</li>
        <li><strong>Inventory Duplication:</strong> Eliminated edge cases causing duplicate items</li>
      </ul>

      <h3>General Fixes</h3>
      <ul>
        <li><strong>Scatter Algorithm Edge Cases:</strong> Prevented characters from spawning off-screen</li>
        <li><strong>Modal Close Handlers:</strong> Fixed issues with modals not properly closing</li>
        <li><strong>Auth Session Persistence:</strong> Resolved logout/login state inconsistencies</li>
        <li><strong>Asset Upload Validation:</strong> Improved error handling for malformed submissions</li>
        <li><strong>Vote Counting Accuracy:</strong> Corrected vote tallying logic</li>
      </ul>
    </div>

    <!-- Known Issues -->
    <div class="section">
      <h2>Known Issues</h2>

      <div class="info-box">
        <strong>Current Limitations</strong>
        <ul style="margin-top: 0.5rem;">
          <li><strong>Mobile Support:</strong> Interface not yet optimized for mobile/tablet devices</li>
          <li><strong>Browser Compatibility:</strong> Best performance on Chrome/Chromium; Firefox/Safari may have rendering quirks</li>
          <li><strong>Scale Testing:</strong> System has not been tested with 100+ concurrent users</li>
          <li><strong>Incomplete Features:</strong> Some UI elements are placeholders for upcoming functionality</li>
        </ul>
      </div>

      <h4>In Development</h4>
      <ul>
        <li><strong>Zone Exploration:</strong> Zone entry and discovery mechanics planned for v0.5</li>
        <li><strong>Combat System:</strong> Attack, defense, and skill mechanics in design phase</li>
        <li><strong>Economy:</strong> Trading, markets, and currency systems coming soon</li>
        <li><strong>Faction Warfare:</strong> Territory conquest and PvP systems planned</li>
        <li><strong>Lore Database:</strong> Tome/encyclopedia system partially implemented</li>
      </ul>
    </div>

    <!-- Breaking Changes -->
    <div class="section">
      <h2>Breaking Changes <span class="badge badge-breaking">Important</span></h2>

      <div class="warning-box">
        <strong>⚠️ Database Reset Required:</strong> This update includes a full galaxy reset. All character positions and game state have been wiped. Character data (names, equipment, progression) is preserved.
      </div>

      <div class="warning-box">
        <strong>⚠️ Deprecated Views:</strong> Old EJS templates have been moved to <code>.deprecated_views/</code> in favor of enhanced versions.
      </div>
    </div>

    <!-- Migration Guide -->
    <div class="section">
      <h2>Migration Guide</h2>

      <h3>For Existing Players</h3>
      <ol style="padding-left: 1.5rem; color: #cbd5e1;">
        <li><strong>Re-select your character</strong> on the <code>/auth</code> page after logging in</li>
        <li><strong>Your character will spawn</strong> at a default starting location based on faction</li>
        <li><strong>Inventory items are preserved</strong>, but you may need to re-equip them</li>
        <li><strong>Submitted assets remain intact</strong>, no re-upload needed</li>
      </ol>

      <h3>For Developers</h3>
      <ol style="padding-left: 1.5rem; color: #cbd5e1;">
        <li><strong>New environment variables</strong> may be required (see <code>.env.example</code>)</li>
        <li><strong>Database indexes</strong> should be rebuilt after update</li>
        <li><strong>Socket event handlers</strong> have new signatures; check documentation</li>
        <li><strong>Asset upload endpoints</strong> now require authentication</li>
      </ol>
    </div>

    <!-- Next Steps -->
    <div class="section">
      <h2>Next Steps - v0.5 Roadmap Preview</h2>
      <ul>
        <li><strong>Zone Exploration:</strong> Enter and discover unique environments</li>
        <li><strong>Combat System:</strong> PvE and PvP combat mechanics</li>
        <li><strong>Enhanced Social:</strong> Guilds, parties, and messaging</li>
        <li><strong>Mobile Optimization:</strong> Responsive interface for all devices</li>
        <li><strong>Performance:</strong> Scalability improvements for larger player counts</li>
      </ul>
    </div>

    <!-- Footer -->
    <div class="section" style="text-align: center; border-top: 2px solid rgba(99, 102, 241, 0.3); padding-top: 2rem; margin-top: 3rem;">
      <p style="font-size: 1.25rem; color: #6366f1; font-weight: 600;">Thank you for playing Stringborn Universe!</p>
      <p style="font-style: italic; color: #94a3b8; margin-top: 1rem;">This is just the beginning of our journey together.</p>
    </div>

    <div class="button-container">
      <a href="/menu" class="back-button">← Back to Navigation Hub</a>
    </div>
  </div>

  <%- include('../partials/footer') %>
</body>
</html>
