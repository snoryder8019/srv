<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - Character</title>
  <link rel="stylesheet" href="/stylesheets/style.css">
  <link rel="stylesheet" href="/stylesheets/character-detail.css">
</head>
<body>
  <%- include('../partials/header', { user: user }) %>

  <main class="character-container">
    <div class="character-header">
      <h1><%= character.name %></h1>
      <div class="character-level">
        <span class="level-badge">Level <%= character.level %></span>
        <span class="class-badge"><%= character.primaryClass %></span>
      </div>
    </div>

    <div class="character-layout">
      <!-- Left Column: Character Info + Equipment -->
      <div class="left-column">
        <!-- Character Info Card -->
        <div class="card character-info-card">
          <h2>Character Information</h2>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Species:</span>
              <span class="info-value"><%= character.species %></span>
            </div>
            <div class="info-item">
              <span class="info-label">String Domain:</span>
              <span class="info-value"><%= character.stringDomain %></span>
            </div>
            <div class="info-item">
              <span class="info-label">Home Star:</span>
              <span class="info-value"><%= character.homeStar %></span>
            </div>
            <div class="info-item">
              <span class="info-label">Home Planet:</span>
              <span class="info-value"><%= character.homePlanet %></span>
            </div>
          </div>
        </div>

        <!-- Equipment Window -->
        <div class="card equipment-card">
          <h2>Equipment</h2>
          <div class="equipment-grid">
            <!-- Head -->
            <div class="equipment-slot" data-slot="head">
              <div class="slot-icon">‚õëÔ∏è</div>
              <div class="slot-label">Head</div>
              <div class="slot-item" id="slot-head">
                <% if (character.equipped.head) { %>
                  <%= character.equipped.head.name %>
                <% } else { %>
                  <span class="empty-slot">Empty</span>
                <% } %>
              </div>
            </div>

            <!-- Chest -->
            <div class="equipment-slot" data-slot="chest">
              <div class="slot-icon">üõ°Ô∏è</div>
              <div class="slot-label">Chest</div>
              <div class="slot-item" id="slot-chest">
                <% if (character.equipped.chest) { %>
                  <%= character.equipped.chest.name %>
                <% } else { %>
                  <span class="empty-slot">Empty</span>
                <% } %>
              </div>
            </div>

            <!-- Legs -->
            <div class="equipment-slot" data-slot="legs">
              <div class="slot-icon">üëñ</div>
              <div class="slot-label">Legs</div>
              <div class="slot-item" id="slot-legs">
                <% if (character.equipped.legs) { %>
                  <%= character.equipped.legs.name %>
                <% } else { %>
                  <span class="empty-slot">Empty</span>
                <% } %>
              </div>
            </div>

            <!-- Feet -->
            <div class="equipment-slot" data-slot="feet">
              <div class="slot-icon">üë¢</div>
              <div class="slot-label">Feet</div>
              <div class="slot-item" id="slot-feet">
                <% if (character.equipped.feet) { %>
                  <%= character.equipped.feet.name %>
                <% } else { %>
                  <span class="empty-slot">Empty</span>
                <% } %>
              </div>
            </div>

            <!-- Hands -->
            <div class="equipment-slot" data-slot="hands">
              <div class="slot-icon">üß§</div>
              <div class="slot-label">Hands</div>
              <div class="slot-item" id="slot-hands">
                <% if (character.equipped.hands) { %>
                  <%= character.equipped.hands.name %>
                <% } else { %>
                  <span class="empty-slot">Empty</span>
                <% } %>
              </div>
            </div>

            <!-- Weapon -->
            <div class="equipment-slot weapon-slot" data-slot="weapon">
              <div class="slot-icon">‚öîÔ∏è</div>
              <div class="slot-label">Weapon</div>
              <div class="slot-item" id="slot-weapon">
                <% if (character.equipped.weapon) { %>
                  <%= character.equipped.weapon.name %>
                <% } else { %>
                  <span class="empty-slot">Empty</span>
                <% } %>
              </div>
            </div>

            <!-- Off-hand -->
            <div class="equipment-slot" data-slot="offhand">
              <div class="slot-icon">ü™ì</div>
              <div class="slot-label">Off-hand</div>
              <div class="slot-item" id="slot-offhand">
                <% if (character.equipped.offhand) { %>
                  <%= character.equipped.offhand.name %>
                <% } else { %>
                  <span class="empty-slot">Empty</span>
                <% } %>
              </div>
            </div>

            <!-- Trinket 1 -->
            <div class="equipment-slot trinket-slot" data-slot="trinket1">
              <div class="slot-icon">üíé</div>
              <div class="slot-label">Trinket 1</div>
              <div class="slot-item" id="slot-trinket1">
                <% if (character.equipped.trinket1) { %>
                  <%= character.equipped.trinket1.name %>
                <% } else { %>
                  <span class="empty-slot">Empty</span>
                <% } %>
              </div>
            </div>

            <!-- Trinket 2 -->
            <div class="equipment-slot trinket-slot" data-slot="trinket2">
              <div class="slot-icon">üíé</div>
              <div class="slot-label">Trinket 2</div>
              <div class="slot-item" id="slot-trinket2">
                <% if (character.equipped.trinket2) { %>
                  <%= character.equipped.trinket2.name %>
                <% } else { %>
                  <span class="empty-slot">Empty</span>
                <% } %>
              </div>
            </div>
          </div>
        </div>

        <!-- Stats Card -->
        <div class="card stats-card">
          <h2>Base Stats</h2>
          <div class="stats-list">
            <div class="stat-item">
              <span class="stat-label">Strength:</span>
              <div class="stat-bar">
                <div class="stat-fill" style="width: <%= Math.min(character.stats.strength * 2, 100) %>%"></div>
                <span class="stat-value"><%= character.stats.strength %></span>
              </div>
            </div>
            <div class="stat-item">
              <span class="stat-label">Intelligence:</span>
              <div class="stat-bar">
                <div class="stat-fill" style="width: <%= Math.min(character.stats.intelligence * 2, 100) %>%"></div>
                <span class="stat-value"><%= character.stats.intelligence %></span>
              </div>
            </div>
            <div class="stat-item">
              <span class="stat-label">Agility:</span>
              <div class="stat-bar">
                <div class="stat-fill" style="width: <%= Math.min(character.stats.agility * 2, 100) %>%"></div>
                <span class="stat-value"><%= character.stats.agility %></span>
              </div>
            </div>
            <div class="stat-item">
              <span class="stat-label">Faith:</span>
              <div class="stat-bar">
                <div class="stat-fill" style="width: <%= Math.min(character.stats.faith * 2, 100) %>%"></div>
                <span class="stat-value"><%= character.stats.faith %></span>
              </div>
            </div>
            <div class="stat-item">
              <span class="stat-label">Tech:</span>
              <div class="stat-bar">
                <div class="stat-fill" style="width: <%= Math.min(character.stats.tech * 2, 100) %>%"></div>
                <span class="stat-value"><%= character.stats.tech %></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column: Talent Tree -->
      <div class="right-column">
        <div class="card talent-tree-card">
          <div class="talent-tree-header">
            <h2>Talent Tree</h2>
            <div class="talent-points">
              <span class="points-available" id="talentPoints"><%= character.talents?.availablePoints || 0 %></span>
              <span class="points-label">Points Available</span>
            </div>
          </div>

          <div class="talent-tree" id="talentTree">
            <!-- Tier 1 -->
            <div class="talent-tier" data-tier="1">
              <div class="tier-label">Tier 1</div>
              <div class="talents-row">
                <div class="talent-node" data-talent="strength_boost_1">
                  <div class="talent-icon">üí™</div>
                  <div class="talent-name">Strength I</div>
                  <div class="talent-rank">
                    <span class="current-rank">0</span>/<span class="max-rank">5</span>
                  </div>
                  <div class="talent-description">+2 Strength per rank</div>
                </div>

                <div class="talent-node" data-talent="intelligence_boost_1">
                  <div class="talent-icon">üß†</div>
                  <div class="talent-name">Intelligence I</div>
                  <div class="talent-rank">
                    <span class="current-rank">0</span>/<span class="max-rank">5</span>
                  </div>
                  <div class="talent-description">+2 Intelligence per rank</div>
                </div>

                <div class="talent-node" data-talent="agility_boost_1">
                  <div class="talent-icon">üèÉ</div>
                  <div class="talent-name">Agility I</div>
                  <div class="talent-rank">
                    <span class="current-rank">0</span>/<span class="max-rank">5</span>
                  </div>
                  <div class="talent-description">+2 Agility per rank</div>
                </div>
              </div>
            </div>

            <!-- Tier 2 -->
            <div class="talent-tier" data-tier="2">
              <div class="tier-label">Tier 2 <span class="tier-requirement">(Requires 5 points in Tier 1)</span></div>
              <div class="talents-row">
                <div class="talent-node locked" data-talent="combat_mastery" data-requires="5">
                  <div class="talent-icon">‚öîÔ∏è</div>
                  <div class="talent-name">Combat Mastery</div>
                  <div class="talent-rank">
                    <span class="current-rank">0</span>/<span class="max-rank">3</span>
                  </div>
                  <div class="talent-description">+5% damage per rank</div>
                </div>

                <div class="talent-node locked" data-talent="tech_affinity" data-requires="5">
                  <div class="talent-icon">‚öôÔ∏è</div>
                  <div class="talent-name">Tech Affinity</div>
                  <div class="talent-rank">
                    <span class="current-rank">0</span>/<span class="max-rank">3</span>
                  </div>
                  <div class="talent-description">+3 Tech per rank</div>
                </div>

                <div class="talent-node locked" data-talent="faith_power" data-requires="5">
                  <div class="talent-icon">‚ú®</div>
                  <div class="talent-name">Faith Power</div>
                  <div class="talent-rank">
                    <span class="current-rank">0</span>/<span class="max-rank">3</span>
                  </div>
                  <div class="talent-description">+3 Faith per rank</div>
                </div>
              </div>
            </div>

            <!-- Tier 3 -->
            <div class="talent-tier" data-tier="3">
              <div class="tier-label">Tier 3 <span class="tier-requirement">(Requires 10 points in Tiers 1-2)</span></div>
              <div class="talents-row">
                <div class="talent-node ultimate locked" data-talent="berserker_rage" data-requires="10">
                  <div class="talent-icon">üò°</div>
                  <div class="talent-name">Berserker Rage</div>
                  <div class="talent-rank">
                    <span class="current-rank">0</span>/<span class="max-rank">1</span>
                  </div>
                  <div class="talent-description">Gain +50% damage and +25% speed for 10 seconds. Cooldown: 60s</div>
                </div>

                <div class="talent-node ultimate locked" data-talent="tactical_mind" data-requires="10">
                  <div class="talent-icon">üéØ</div>
                  <div class="talent-name">Tactical Mind</div>
                  <div class="talent-rank">
                    <span class="current-rank">0</span>/<span class="max-rank">1</span>
                  </div>
                  <div class="talent-description">All abilities cost 25% less energy and have 15% reduced cooldown</div>
                </div>
              </div>
            </div>
          </div>

          <div class="talent-actions">
            <button class="btn btn-secondary" id="resetTalents">Reset Talents</button>
          </div>
        </div>
      </div>
    </div>

    <div class="character-actions">
      <a href="/characters" class="btn btn-secondary">Back to Characters</a>
    </div>
  </main>

  <%- include('../partials/footer') %>

  <!-- Pass character data to JavaScript -->
  <script>
    window.CHARACTER_ID = "<%= character._id %>";
    window.CHARACTER_DATA = <%- JSON.stringify(character) %>;
  </script>
  <script src="/javascripts/character-detail.js"></script>
</body>
</html>
