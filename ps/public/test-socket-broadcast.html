<!DOCTYPE html>
<html>
<head>
    <title>Socket.IO Character Broadcast Test</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body {
            background: #000;
            color: #0f0;
            font-family: monospace;
            padding: 20px;
        }
        .log {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #0f0;
        }
        .character {
            color: #0ff;
            margin: 5px 0;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <h1>Socket.IO Character Broadcast Test</h1>
    <div id="status">Connecting...</div>
    <div id="logs"></div>

    <script>
        const socket = io();
        const logsDiv = document.getElementById('logs');
        const statusDiv = document.getElementById('status');

        socket.on('connect', () => {
            statusDiv.textContent = 'âœ… Connected to Socket.IO';
            statusDiv.style.color = '#0f0';
            log('Connected to server');
        });

        socket.on('disconnect', () => {
            statusDiv.textContent = 'âŒ Disconnected from Socket.IO';
            statusDiv.style.color = '#f00';
            log('Disconnected from server');
        });

        socket.on('galacticPhysicsUpdate', (data) => {
            log('galacticPhysicsUpdate received');
            console.log('Full payload:', data);

            if (data.characters && data.characters.length > 0) {
                log(`ðŸ“¦ ${data.characters.length} characters:`);
                data.characters.forEach(char => {
                    log(`  ðŸ‘¤ ${char.name} at (${char.location.x.toFixed(0)}, ${char.location.y.toFixed(0)}, ${char.location.z.toFixed(0)}) docked at: ${char.dockedGalaxyName}`, 'character');
                });
            } else {
                log('âš ï¸ No characters in update');
            }

            log(`ðŸ“Š Galaxies: ${data.galaxies?.length || 0}, Stars: ${data.stars?.length || 0}, Connections: ${data.connections?.length || 0}`);
        });

        function log(message, className = '') {
            const div = document.createElement('div');
            div.className = 'log ' + className;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsDiv.insertBefore(div, logsDiv.firstChild);

            // Keep only last 50 logs
            while (logsDiv.children.length > 50) {
                logsDiv.removeChild(logsDiv.lastChild);
            }
        }
    </script>
</body>
</html>
